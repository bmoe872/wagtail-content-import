



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Submitting a New Backend - Wagtail Content Import Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#submitting-a-new-picker" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Wagtail Content Import Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Wagtail Content Import Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Submitting a New Backend
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Wagtail Content Import Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Wagtail Content Import Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting_started/" title="Basic Setup" class="md-nav__link">
      Basic Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../google_docs_setup/" title="Google Docs Setup" class="md-nav__link">
      Google Docs Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microsoft_setup/" title="Microsoft Setup" class="md-nav__link">
      Microsoft Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../basic_usage/" title="Basic Usage" class="md-nav__link">
      Basic Usage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flow/" title="The Content Import Flow" class="md-nav__link">
      The Content Import Flow
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Customisation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Customisation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../custom_converters/" title="Writing Custom Converters" class="md-nav__link">
      Writing Custom Converters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../structblocks/" title="Working With StructBlocks" class="md-nav__link">
      Working With StructBlocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../changing_import_fields/" title="Changing Import Fields" class="md-nav__link">
      Changing Import Fields
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../settings/" title="Settings Reference" class="md-nav__link">
      Settings Reference
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Submitting a New Backend
      </label>
    
    <a href="./" title="Submitting a New Backend" class="md-nav__link md-nav__link--active">
      Submitting a New Backend
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#submitting-a-new-picker" class="md-nav__link">
    Submitting a New Picker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-and-file-structure" class="md-nav__link">
    Overview and File Structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my_pickerjs" class="md-nav__link">
    MY_PICKER.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my_picker_js_inithtml" class="md-nav__link">
    MY_PICKER_js_init.html
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__init__py-and-appspy" class="md-nav__link">
    __init__.py and apps.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilspy" class="md-nav__link">
    utils.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wagtail_hookspy" class="md-nav__link">
    wagtail_hooks.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#submitting-a-new-picker" class="md-nav__link">
    Submitting a New Picker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-and-file-structure" class="md-nav__link">
    Overview and File Structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my_pickerjs" class="md-nav__link">
    MY_PICKER.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my_picker_js_inithtml" class="md-nav__link">
    MY_PICKER_js_init.html
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__init__py-and-appspy" class="md-nav__link">
    __init__.py and apps.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilspy" class="md-nav__link">
    utils.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wagtail_hookspy" class="md-nav__link">
    wagtail_hooks.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Submitting a New Backend</h1>
                
                <p>Thanks for being interested in contributing! All contributions should be submitted as pull requests
to the <a href="https://github.com/torchbox/wagtail-content-import">Wagtail Content Import repository</a>.</p>
<h2 id="submitting-a-new-picker">Submitting a New Picker</h2>
<p>If you're planning on submitting a new picker - apps which enable choosing and importing a file from a 
remote source - you'll need to follow this blueprint:</p>
<h3 id="overview-and-file-structure">Overview and File Structure</h3>
<p>Inside <code>wagtail_content_import.pickers</code>, your app should have the following structure:</p>
<ul>
<li><code>my_picker</code><ul>
<li><code>static</code><ul>
<li><code>wagtail_content_import</code><ul>
<li><code>MY_PICKER.js</code></li>
</ul>
</li>
</ul>
</li>
<li><code>templates</code><ul>
<li><code>wagtail_content_import</code><ul>
<li><code>MY_PICKER_js_init.html</code></li>
</ul>
</li>
</ul>
</li>
<li><code>__init__.py</code></li>
<li><code>apps.py</code></li>
<li><code>utils.py</code></li>
<li><code>wagtail_hooks.py</code></li>
</ul>
</li>
</ul>
<p>Where <code>MY_PICKER</code> should be replaced with the name of your picker.</p>
<ul>
<li><code>MY_PICKER.js</code> provides the JavaScript class for your picker, which will select a file and make
a POST request to the page with relevant data using a hidden form</li>
<li><code>MY_PICKER_js_init.html</code> creates an instance of that class on the <code>Create</code> page, using
  a template filled in with the relevant settings,
  and sets up a listener to call that class's <code>.show()</code> method on clicking the relevant import
  button.</li>
<li><code>__init__.py</code> and <code>apps.py</code> set your app's name and label.</li>
<li><code>utils.py</code> adds your Python picker class, eg <code>GooglePicker</code></li>
<li><code>wagtail_hooks.py</code> registers your picker using a Wagtail hook, and adds a <code>before_create_page</code> hook
to actually take the POST-ed document data and import it, using a parser.</li>
</ul>
<p>The following examples will follow a picker which needs a variable <code>AUTH_PARAMETERS</code> available in the 
JavaScript in order to import content.</p>
<h4 id="my_pickerjs"><code>MY_PICKER.js</code></h4>
<p>This adds the JavaScript class for your picker, and adds it to the window. It should implement
a method to show the picker, and upon choosing, make a POST request to the page using a hidden form
with relevant data that allows Wagtail to import the document: for the Google picker, this is a JSON
containing the document; for the Microsoft picker, this is a temporary url allowing the file to be downloaded.</p>
<p>Eg:</p>
<pre><code class="javascript">(function() {
    class MyPicker {
        constructor(AUTH_PARAMETERS, createPageUrl, csrfToken) {
        this.AUTH_PARAMETERS = AUTH_PARAMETERS;
        this.createPageUrl = createPageUrl;
        this.csrfToken = csrfToken;
        }

        post_data(response) {
            // POST relevant data to the page
            // Use a hidden form so the browser reloads with the result of this request
            let form = document.createElement('form');
            form.action = this.createPageUrl;
            form.method = 'POST';
            form.style.visibility = 'hidden';
            document.body.appendChild(form);

            let csrfTokenField = document.createElement('input');
            csrfTokenField.type = 'hidden';
            csrfTokenField.name = 'csrfmiddlewaretoken';
            csrfTokenField.value = this.csrfToken;
            form.appendChild(csrfTokenField);

            let myDocField = document.createElement('input');
            myDocField.type = 'hidden';
            myDocField.name = 'my-doc';
            myDocField.value = response.value;
            form.appendChild(myDocField);

            form.submit();
        }


        show() {
          # Open the picker here, and call this.post_data(response) on successfully getting a file
        }
    }

    window.MyPicker = MyPicker;
})();
</code></pre>

<h4 id="my_picker_js_inithtml"><code>MY_PICKER_js_init.html</code></h4>
<p>This should provide a Django template which creates an instance of your JS picker class, populated with
the relevant variables, which can be filled in by the Django side using your Python picker class. It must also add a listener to the 
relevant import button, such that when it is clicked, it calls <code>myPicker.show()</code>.</p>
<p>Eg:</p>
<pre><code class="html">&lt;script type=&quot;text/javascript&quot;&gt;
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-content-import-picker=&quot;my_picker&quot;]').forEach(function (element) {
            let myPicker = new MyPicker({{ AUTH_PARAMETERS }}, element.dataset.createPageUrl, '{{ csrf_token|escapejs }}');

            element.addEventListener('click', function(e) {
                e.preventDefault();
                myPicker.show();
            });
        });
    });
&lt;/script&gt;

</code></pre>

<h4 id="__init__py-and-appspy"><code>__init__.py</code> and <code>apps.py</code></h4>
<p><code>init.py</code>:</p>
<pre><code class="python">default_app_config = 'wagtail_content_import.pickers.my_picker.apps.WagtailContentImportMyPickerAppConfig'
</code></pre>

<p><code>apps.py</code>: </p>
<pre><code class="python">from django.apps import AppConfig


class WagtailContentImportMyPickerAppConfig(AppConfig):
    name = 'wagtail_content_import.pickers.my_picker'
    label = 'wagtail_content_import_my_picker'
    verbose_name = &quot;Wagtail Content Import - My Picker&quot;
</code></pre>

<h4 id="utilspy"><code>utils.py</code></h4>
<p>Here, you'll need to create the Python class for your new picker, which will provide the names
and context needed by the <code>js_init</code> template.</p>
<pre><code class="python">from django.template.loader import render_to_string
from django.utils.safestring import mark_safe

from wagtail_content_import.pickers import Picker


class MyPicker(Picker):
    name = &quot;my_picker&quot;
    verbose_name = &quot;My Picker&quot;

    def __init__(self, AUTH_PARAMETERS):
        self.AUTH_PARAMETERS = AUTH_PARAMETERS

    def get_context(self):
        return {
            'picker': self,
            'AUTH_PARAMETERS': self.AUTH_PARAMETERS,
        }

    js_template = 'wagtail_content_import/MY_PICKER_js_init.html'

    def render_js_init(self, request):
        return mark_safe(render_to_string(self.js_template, self.get_context(), request=request))

    class Media:
        css = {}
        js = [
            # ANY EXTRA JS YOU NEED HERE 
            'wagtail_content_import/MY_PICKER.js',
        ]
</code></pre>

<h3 id="wagtail_hookspy"><code>wagtail_hooks.py</code></h3>
<p>Finally, here you'll need to register your picker, and add a <code>before create page</code> hook to actually
import posted content.</p>
<p>Eg:</p>
<pre><code class="python">from django.conf import settings

from wagtail.core import hooks

from .utils import MyPicker

from ...utils import create_page_from_import


@hooks.register(&quot;before_create_page&quot;)
def create_from_my_doc(request, parent_page, page_class):
    if &quot;my-doc&quot; in request.POST:
        parsed_doc = # PARSE THE DOCUMENT HERE
        return create_page_from_import(request, parent_page, page_class, parsed_doc)


@hooks.register('register_content_import_picker')
def register_content_import_picker():
    return MyPicker(
        settings.AUTH_PARAMETERS,
    )
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../settings/" title="Settings Reference" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Settings Reference
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>